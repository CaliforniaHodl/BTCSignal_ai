{{ define "main" }}
<div class="container premium-page alerts-page history-page" id="alert-history-page">
  <header class="alerts-header">
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <a href="/alerts/">Alerts</a> / <span>History</span>
    </nav>
    <h1>Alert History</h1>
    <p class="subtitle">View and manage all your triggered alerts</p>
  </header>

  <!-- Stats Bar -->
  <div class="history-stats-bar">
    <div class="stat-item">
      <span class="stat-value" id="stat-total">0</span>
      <span class="stat-label">Total Alerts</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" id="stat-24h">0</span>
      <span class="stat-label">Last 24h</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" id="stat-7d">0</span>
      <span class="stat-label">Last 7 Days</span>
    </div>
  </div>

  <!-- Filters Section -->
  <section class="history-filters">
    <div class="filters-row">
      <div class="filter-group">
        <label for="filter-category">Category</label>
        <select id="filter-category">
          <option value="all">All Categories</option>
          <option value="price">Price Alerts</option>
          <option value="onchain">On-Chain</option>
          <option value="derivatives">Derivatives</option>
          <option value="technical">Technical</option>
          <option value="system">System</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filter-date">Time Range</label>
        <select id="filter-date">
          <option value="all">All Time</option>
          <option value="24h">Last 24 Hours</option>
          <option value="7d">Last 7 Days</option>
          <option value="30d">Last 30 Days</option>
        </select>
      </div>

      <div class="filter-group search-group">
        <label for="filter-search">Search</label>
        <input type="text" id="filter-search" placeholder="Search alerts...">
      </div>
    </div>

    <div class="filters-actions">
      <span class="filter-count" id="filter-count">Showing 0 alerts</span>
      <div class="action-buttons">
        <button class="btn-export" id="btn-export-csv" title="Export as CSV">
          <span class="btn-icon">üìä</span> CSV
        </button>
        <button class="btn-export" id="btn-export-json" title="Export as JSON">
          <span class="btn-icon">üìÑ</span> JSON
        </button>
        <button class="btn-clear" id="btn-clear-all" title="Clear all history">
          <span class="btn-icon">üóëÔ∏è</span> Clear All
        </button>
      </div>
    </div>
  </section>

  <!-- History List -->
  <section class="history-list-section">
    <div class="history-list" id="history-list">
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading history...</p>
      </div>
    </div>
  </section>

  <!-- Back to Alerts -->
  <div class="back-link">
    <a href="/alerts/">&larr; Back to Alert System</a>
  </div>
</div>

<style>
  .history-page .alerts-header { padding-bottom: 1rem; }
  .history-page .breadcrumb { margin-bottom: 0.5rem; font-size: 0.875rem; }
  .history-page .breadcrumb a { color: var(--bitcoin-orange); text-decoration: none; }
  .history-page .breadcrumb a:hover { text-decoration: underline; }

  .history-stats-bar {
    display: flex;
    gap: 1.5rem;
    padding: 1rem 1.5rem;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 1.5rem;
  }
  .history-stats-bar .stat-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }
  .history-stats-bar .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
  }
  .history-stats-bar .stat-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .history-filters {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem 1.5rem;
    margin-bottom: 1.5rem;
  }
  .filters-row {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    margin-bottom: 1rem;
  }
  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    min-width: 150px;
  }
  .filter-group.search-group { flex: 1; min-width: 200px; }
  .filter-group label {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .filter-group select,
  .filter-group input {
    background: var(--bg-dark);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 0.5rem 0.75rem;
    color: var(--text-primary);
    font-size: 0.875rem;
  }
  .filter-group select:focus,
  .filter-group input:focus {
    border-color: var(--bitcoin-orange);
    outline: none;
  }

  .filters-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
  }
  .filter-count { color: var(--text-muted); font-size: 0.875rem; }
  .action-buttons { display: flex; gap: 0.5rem; }
  .btn-export, .btn-clear {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 0.75rem;
    background: var(--bg-dark);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    color: var(--text-secondary);
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-export:hover, .btn-clear:hover {
    background: var(--bg-card-hover);
    color: var(--text-primary);
  }
  .btn-clear { border-color: var(--red); color: var(--red); }
  .btn-clear:hover { background: rgba(248, 81, 73, 0.1); }

  .history-list-section {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
  }

  .history-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    transition: background 0.2s;
  }
  .history-item:last-child { border-bottom: none; }
  .history-item:hover { background: var(--bg-dark); }

  .history-icon {
    font-size: 1.5rem;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-dark);
    border-radius: 8px;
    flex-shrink: 0;
  }
  .history-content { flex: 1; }
  .history-condition {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
  }
  .history-note {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }
  .history-meta {
    display: flex;
    gap: 1rem;
    font-size: 0.75rem;
    color: var(--text-muted);
  }
  .history-category {
    background: var(--bg-dark);
    padding: 0.125rem 0.5rem;
    border-radius: 4px;
    text-transform: uppercase;
  }
  .history-delete {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 1.25rem;
    cursor: pointer;
    padding: 0.25rem;
    line-height: 1;
    opacity: 0;
    transition: all 0.2s;
  }
  .history-item:hover .history-delete { opacity: 1; }
  .history-delete:hover { color: var(--red); }

  .back-link {
    margin-top: 1.5rem;
    text-align: center;
  }
  .back-link a {
    color: var(--bitcoin-orange);
    text-decoration: none;
    font-size: 0.875rem;
  }
  .back-link a:hover { text-decoration: underline; }

  .no-history {
    padding: 3rem;
    text-align: center;
    color: var(--text-muted);
  }

  @media (max-width: 768px) {
    .history-stats-bar { flex-wrap: wrap; }
    .filters-row { flex-direction: column; }
    .filters-actions { flex-direction: column; gap: 1rem; }
    .action-buttons { width: 100%; justify-content: center; }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize stats
  function updateStats() {
    const stats = AlertHistory.getStats();
    document.getElementById('stat-total').textContent = stats.total;
    document.getElementById('stat-24h').textContent = stats.last24h;
    document.getElementById('stat-7d').textContent = stats.last7d;
  }

  // Initialize filters
  document.getElementById('filter-category').addEventListener('change', function() {
    AlertHistory.setFilters({ category: this.value });
    renderHistory();
  });

  document.getElementById('filter-date').addEventListener('change', function() {
    AlertHistory.setFilters({ dateRange: this.value });
    renderHistory();
  });

  document.getElementById('filter-search').addEventListener('input', function() {
    AlertHistory.setFilters({ search: this.value });
    renderHistory();
  });

  // Export buttons
  document.getElementById('btn-export-csv').addEventListener('click', function() {
    AlertHistory.exportCSV();
  });

  document.getElementById('btn-export-json').addEventListener('click', function() {
    AlertHistory.exportJSON();
  });

  // Clear all
  document.getElementById('btn-clear-all').addEventListener('click', function() {
    if (confirm('Are you sure you want to clear all alert history? This cannot be undone.')) {
      AlertHistory.clear();
      renderHistory();
      updateStats();
    }
  });

  // Render history
  function renderHistory() {
    AlertHistory.render('#history-list');
    const filtered = AlertHistory.getFiltered();
    const total = AlertHistory.getAll().length;
    document.getElementById('filter-count').textContent =
      `Showing ${filtered.length} of ${total} alerts`;
  }

  // Listen for updates
  window.addEventListener('alertHistoryUpdated', function() {
    updateStats();
    renderHistory();
  });

  // Initial render
  updateStats();
  renderHistory();
});
</script>
{{ end }}
