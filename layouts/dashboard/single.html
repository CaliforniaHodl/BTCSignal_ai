{{ define "main" }}
<div class="container dashboard-page" id="dashboard-container">
  <!-- Paywall check - show content only if user has paid -->
  <div class="dashboard-locked" id="dashboard-locked">
    <div class="lock-message">
      <div class="lightning-icon">üîí</div>
      <h2>Premium Dashboard</h2>
      <p>Get access to advanced trading tools and real-time market data</p>
      <a href="/pricing/" class="btn-lightning">View Pricing</a>
    </div>
  </div>

  <div class="dashboard-content" id="dashboard-content" style="display: none;">
    <header class="dashboard-header">
      <h1>Pro Trading Dashboard</h1>
      <p class="subtitle">Real-time market intelligence & performance analytics</p>
    </header>

    <!-- Market Sentiment Grid - Market Sentiment Style Widgets (3x more) -->
    <section class="dashboard-widgets">
      <h2>Market Intelligence</h2>
      <p class="section-desc">Real-time sentiment indicators and market metrics</p>
      <div class="dashboard-grid">
        <!-- Fear & Greed Widget -->
        <div class="widget-card widget-fng">
          <div class="widget-header">
            <span class="widget-icon">üò±</span>
            <h3>Fear & Greed Index</h3>
          </div>
          <div class="widget-value" id="dash-fng-value">--</div>
          <div class="widget-label" id="dash-fng-label">Loading...</div>
          <div class="widget-chart">
            <div class="fng-gradient-bar">
              <div class="fng-indicator" id="dash-fng-indicator" style="left: 50%"></div>
            </div>
          </div>
        </div>

        <!-- Funding Rate Widget -->
        <div class="widget-card widget-funding">
          <div class="widget-header">
            <span class="widget-icon">üí∞</span>
            <h3>BTC Funding Rate</h3>
          </div>
          <div class="widget-value" id="dash-funding-value">--</div>
          <div class="widget-label" id="dash-funding-label">Loading...</div>
          <div class="widget-sublabel">8h perpetual rate</div>
        </div>

        <!-- Open Interest Widget -->
        <div class="widget-card widget-volume">
          <div class="widget-header">
            <span class="widget-icon">üìä</span>
            <h3>Open Interest</h3>
          </div>
          <div class="widget-value" id="dash-oi-value">--</div>
          <div class="widget-label" id="dash-oi-change">Loading...</div>
          <div class="widget-sublabel">Total leveraged positions</div>
        </div>

        <!-- Buy/Sell Volume Widget -->
        <div class="widget-card widget-signals">
          <div class="widget-header">
            <span class="widget-icon">‚öñÔ∏è</span>
            <h3>Buy/Sell Ratio</h3>
          </div>
          <div class="widget-value" id="dash-ratio-value">--</div>
          <div class="widget-label" id="dash-ratio-label">Loading...</div>
          <div class="widget-chart">
            <div class="vol-bar-container" id="dash-vol-bars">
              <div class="vol-bar buy" style="width: 50%"></div>
              <div class="vol-bar sell" style="width: 50%"></div>
            </div>
          </div>
        </div>

        <!-- Long/Short Ratio Widget -->
        <div class="widget-card widget-performance">
          <div class="widget-header">
            <span class="widget-icon">üìà</span>
            <h3>Long/Short Ratio</h3>
          </div>
          <div class="widget-value" id="dash-ls-value">--</div>
          <div class="widget-label" id="dash-ls-label">Loading...</div>
          <div class="widget-sublabel">Top traders positioning</div>
        </div>

        <!-- Liquidations 24h Widget -->
        <div class="widget-card widget-liquidation">
          <div class="widget-header">
            <span class="widget-icon">üî•</span>
            <h3>24h Liquidations</h3>
          </div>
          <div class="widget-value" id="dash-liq-value">--</div>
          <div class="widget-label" id="dash-liq-label">Loading...</div>
          <div class="widget-sublabel">Long vs Short breakdown</div>
        </div>

        <!-- RSI Widget -->
        <div class="widget-card widget-patterns">
          <div class="widget-header">
            <span class="widget-icon">üìâ</span>
            <h3>RSI (14)</h3>
          </div>
          <div class="widget-value" id="dash-rsi-value">--</div>
          <div class="widget-label" id="dash-rsi-label">Loading...</div>
          <div class="widget-sublabel">4H timeframe</div>
        </div>

        <!-- Volatility Widget -->
        <div class="widget-card widget-alerts">
          <div class="widget-header">
            <span class="widget-icon">‚ö°</span>
            <h3>Volatility Index</h3>
          </div>
          <div class="widget-value" id="dash-vol-value">--</div>
          <div class="widget-label" id="dash-vol-label">Loading...</div>
          <div class="widget-sublabel">24h price range %</div>
        </div>

        <!-- Dominance Widget -->
        <div class="widget-card widget-calendar">
          <div class="widget-header">
            <span class="widget-icon">üëë</span>
            <h3>BTC Dominance</h3>
          </div>
          <div class="widget-value" id="dash-dom-value">--</div>
          <div class="widget-label" id="dash-dom-label">Loading...</div>
          <div class="widget-sublabel">Market share</div>
        </div>
      </div>
    </section>

    <!-- Performance Stats -->
    <section class="stats-section">
      <h2>Signal Performance</h2>
      <div class="stats-grid">
        <div class="stat-card win">
          <span class="stat-number" id="win-count">-</span>
          <span class="stat-label">Winning Calls</span>
        </div>
        <div class="stat-card loss">
          <span class="stat-number" id="loss-count">-</span>
          <span class="stat-label">Losing Calls</span>
        </div>
        <div class="stat-card rate">
          <span class="stat-number" id="win-rate">-</span>
          <span class="stat-label">Win Rate</span>
        </div>
        <div class="stat-card streak">
          <span class="stat-number" id="current-streak">-</span>
          <span class="stat-label">Current Streak</span>
        </div>
      </div>

      <!-- Extended Trade Metrics -->
      <h3 class="subsection-title">Advanced Metrics</h3>
      <div class="stats-grid">
        <div class="stat-card r-multiple">
          <span class="stat-number" id="avg-r-multiple">-</span>
          <span class="stat-label">Avg R-Multiple</span>
        </div>
        <div class="stat-card drawdown">
          <span class="stat-number" id="max-drawdown">-</span>
          <span class="stat-label">Max Drawdown</span>
        </div>
        <div class="stat-card bias">
          <span class="stat-number" id="long-bias">-</span>
          <span class="stat-label">Directional Bias</span>
        </div>
      </div>

      <!-- Calendar Heatmap -->
      <div class="calendar-section">
        <h3 class="subsection-title">90-Day Activity</h3>
        <div class="calendar-heatmap" id="calendar-heatmap">
          <!-- Populated by JS -->
        </div>
        <div class="calendar-legend">
          <span class="legend-item"><span class="cal-day win"></span> Win</span>
          <span class="legend-item"><span class="cal-day loss"></span> Loss</span>
          <span class="legend-item"><span class="cal-day pending"></span> Pending</span>
          <span class="legend-item"><span class="cal-day"></span> No Trade</span>
        </div>
      </div>
    </section>

    <!-- On-Chain & Macro Metrics -->
    <section class="onchain-section">
      <h2>On-Chain & Macro Analysis</h2>
      <p class="section-desc">Network fundamentals and cross-market correlations</p>

      <div class="onchain-grid">
        <!-- Hashrate vs Price Widget -->
        <div class="onchain-card">
          <div class="onchain-header">
            <span class="onchain-icon">‚õèÔ∏è</span>
            <h3>Hashrate vs Price</h3>
          </div>
          <div class="onchain-metrics">
            <div class="metric-row">
              <span class="metric-label">Network Hashrate</span>
              <span class="metric-value" id="dash-hashrate-value">--</span>
            </div>
            <div class="metric-row">
              <span class="metric-label">30d Change</span>
              <span class="metric-value" id="dash-hashrate-change">--</span>
            </div>
            <div class="metric-row">
              <span class="metric-label">Hash/Price Ratio</span>
              <span class="metric-value" id="dash-hash-price-ratio">--</span>
            </div>
          </div>
          <div class="onchain-signal" id="dash-hashrate-signal">
            <span class="signal-badge neutral">Loading...</span>
          </div>
          <div class="onchain-chart">
            <canvas id="hashrateChart" height="120"></canvas>
          </div>
          <p class="onchain-note">Rising hashrate with stable price = bullish divergence</p>
        </div>

        <!-- BTC vs S&P500 Correlation Widget -->
        <div class="onchain-card">
          <div class="onchain-header">
            <span class="onchain-icon">üìä</span>
            <h3>BTC vs S&P 500</h3>
          </div>
          <div class="onchain-metrics">
            <div class="metric-row">
              <span class="metric-label">30d Correlation</span>
              <span class="metric-value" id="dash-correlation-value">--</span>
            </div>
            <div class="metric-row">
              <span class="metric-label">BTC 30d Return</span>
              <span class="metric-value" id="dash-btc-return">--</span>
            </div>
            <div class="metric-row">
              <span class="metric-label">S&P 30d Return</span>
              <span class="metric-value" id="dash-sp500-return">--</span>
            </div>
          </div>
          <div class="onchain-signal" id="dash-correlation-signal">
            <span class="signal-badge neutral">Loading...</span>
          </div>
          <div class="onchain-chart">
            <canvas id="correlationChart" height="120"></canvas>
          </div>
          <p class="onchain-note">Low correlation = BTC acting as uncorrelated asset</p>
        </div>
      </div>
    </section>

    <!-- Charts -->
    <section class="charts-section">
      <div class="chart-container">
        <h3>Win/Loss History</h3>
        <canvas id="winLossChart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Confidence vs Outcome</h3>
        <canvas id="confidenceChart"></canvas>
      </div>
    </section>

    <!-- Liquidation Watchlist -->
    <section class="liquidation-section">
      <h2>Liquidation Watchlist</h2>
      <p class="section-desc">Key price levels where large liquidations may occur</p>

      <div class="liquidation-grid">
        <div class="liquidation-card long">
          <div class="liq-header">
            <span class="liq-type">üìà LONG LIQUIDATIONS</span>
            <span class="liq-risk high">High Risk Zone</span>
          </div>
          <div class="liq-levels" id="long-liquidations">
            <div class="liq-level">
              <span class="price">Loading...</span>
              <span class="amount"></span>
            </div>
          </div>
        </div>

        <div class="liquidation-card short">
          <div class="liq-header">
            <span class="liq-type">üìâ SHORT LIQUIDATIONS</span>
            <span class="liq-risk high">High Risk Zone</span>
          </div>
          <div class="liq-levels" id="short-liquidations">
            <div class="liq-level">
              <span class="price">Loading...</span>
              <span class="amount"></span>
            </div>
          </div>
        </div>
      </div>

      <div class="current-price-box">
        <span class="label">Current BTC Price</span>
        <span class="price" id="current-btc-price">Loading...</span>
      </div>
    </section>

    <!-- Recent Calls Table -->
    <section class="calls-section">
      <h2>Recent Calls</h2>
      <div class="calls-table-wrapper">
        <table class="calls-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Direction</th>
              <th>Entry Price</th>
              <th>Confidence</th>
              <th>Result</th>
            </tr>
          </thead>
          <tbody id="calls-table-body">
            <!-- Populated by JS -->
          </tbody>
        </table>
      </div>
    </section>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ "src/js/access-manager.js" | relURL }}"></script>
<script src="{{ "src/js/dashboard.js" | relURL }}"></script>
<script src="{{ "src/js/dashboard-widgets.js" | relURL }}"></script>
{{ end }}
