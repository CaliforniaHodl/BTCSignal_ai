{{ define "main" }}
<div class="container premium-page liquidation-map-page">
  {{ partial "dev-banner.html" (dict
    "status" "simulation"
    "todos" (slice
      "Integrate exchange order book APIs (<code>Binance</code>, <code>Bybit</code>)"
      "Fetch real liquidation levels from <code>Coinglass API</code>"
      "Calculate liquidation points from open interest + funding data"
      "Implement WebSocket for real-time updates"
      "Add exchange selector UI (aggregate or per-exchange view)"
    )
  ) }}
  <header class="liq-map-header">
    <h1>Liquidation Heatmap</h1>
    <p class="subtitle">Interactive visualization of leveraged position liquidation levels</p>
    <div class="current-price-banner">
      <span class="label">BTC Price</span>
      <span class="price" id="current-btc">Loading...</span>
      <span class="change" id="price-change-24h"></span>
    </div>
  </header>

  <!-- Main Heatmap Section -->
  <section class="heatmap-section">
    <div class="heatmap-controls">
      <div class="leverage-selector">
        <span class="control-label">Leverage Filter:</span>
        <button class="lev-btn active" data-lev="all">All</button>
        <button class="lev-btn" data-lev="10">10x</button>
        <button class="lev-btn" data-lev="25">25x</button>
        <button class="lev-btn" data-lev="50">50x</button>
        <button class="lev-btn" data-lev="100">100x</button>
      </div>
      <div class="view-controls">
        <button class="view-btn" id="btn-zoom-in">+</button>
        <button class="view-btn" id="btn-zoom-out">-</button>
        <button class="view-btn" id="btn-reset">Reset</button>
      </div>
    </div>

    <div class="heatmap-container">
      <div class="heatmap-chart" id="heatmap-chart">
        <canvas id="liquidation-canvas"></canvas>
        <div class="heatmap-loading" id="heatmap-loading">
          <div class="spinner"></div>
          <span>Calculating liquidation levels...</span>
        </div>
      </div>
      <div class="heatmap-sidebar">
        <div class="price-scale" id="price-scale">
          <!-- Generated by JS -->
        </div>
      </div>
    </div>

    <div class="heatmap-legend">
      <span class="legend-title">Liquidation Density:</span>
      <div class="legend-gradient">
        <span class="legend-low">Low</span>
        <div class="gradient-bar"></div>
        <span class="legend-high">High</span>
      </div>
    </div>
  </section>

  <!-- Key Levels Summary -->
  <section class="liq-summary-section">
    <h2>Key Liquidation Zones</h2>
    <div class="liq-zones-grid">
      <!-- Short Liquidations (above price) -->
      <div class="liq-zone-card shorts">
        <div class="zone-header">
          <span class="zone-icon">üìà</span>
          <h3>Short Liquidation Zones</h3>
          <span class="zone-badge">Above Current Price</span>
        </div>
        <div class="zone-levels" id="short-liq-levels">
          <!-- Generated by JS -->
        </div>
        <p class="zone-desc">Price moves up = shorts get liquidated = more buying pressure</p>
      </div>

      <!-- Long Liquidations (below price) -->
      <div class="liq-zone-card longs">
        <div class="zone-header">
          <span class="zone-icon">üìâ</span>
          <h3>Long Liquidation Zones</h3>
          <span class="zone-badge">Below Current Price</span>
        </div>
        <div class="zone-levels" id="long-liq-levels">
          <!-- Generated by JS -->
        </div>
        <p class="zone-desc">Price moves down = longs get liquidated = more selling pressure</p>
      </div>
    </div>
  </section>

  <!-- Price Magnet Analysis -->
  <section class="magnet-section">
    <h2>Price Magnet Analysis</h2>
    <p class="section-desc">Where is price most likely to go based on liquidation concentration?</p>

    <div class="magnet-cards">
      <div class="magnet-card upside">
        <div class="magnet-header">
          <span class="magnet-direction">Upside Target</span>
          <span class="magnet-confidence" id="upside-confidence">--%</span>
        </div>
        <div class="magnet-price" id="upside-target">--</div>
        <div class="magnet-reasoning" id="upside-reasoning">Loading...</div>
      </div>

      <div class="magnet-card current">
        <div class="magnet-header">
          <span class="magnet-direction">Current Price</span>
        </div>
        <div class="magnet-price" id="magnet-current">--</div>
        <div class="magnet-bias" id="magnet-bias">Calculating bias...</div>
      </div>

      <div class="magnet-card downside">
        <div class="magnet-header">
          <span class="magnet-direction">Downside Target</span>
          <span class="magnet-confidence" id="downside-confidence">--%</span>
        </div>
        <div class="magnet-price" id="downside-target">--</div>
        <div class="magnet-reasoning" id="downside-reasoning">Loading...</div>
      </div>
    </div>
  </section>

  <!-- Liquidation Stats -->
  <section class="liq-stats-section">
    <h2>24H Liquidation Stats</h2>
    <div class="liq-stats-grid">
      <div class="liq-stat-card">
        <span class="stat-icon">üí•</span>
        <div class="stat-value" id="total-liq-24h">--</div>
        <div class="stat-label">Total Liquidated (24h)</div>
      </div>
      <div class="liq-stat-card longs">
        <span class="stat-icon">üìâ</span>
        <div class="stat-value" id="long-liq-24h">--</div>
        <div class="stat-label">Longs Liquidated</div>
      </div>
      <div class="liq-stat-card shorts">
        <span class="stat-icon">üìà</span>
        <div class="stat-value" id="short-liq-24h">--</div>
        <div class="stat-label">Shorts Liquidated</div>
      </div>
      <div class="liq-stat-card">
        <span class="stat-icon">‚öñÔ∏è</span>
        <div class="stat-value" id="liq-ratio">--</div>
        <div class="stat-label">Long/Short Ratio</div>
      </div>
    </div>
  </section>

  <!-- Premium Upsell (if not premium) -->
  <section class="premium-gate" id="premium-gate" style="display: none;">
    <div class="gate-content">
      <h2>Unlock Full Liquidation Analysis</h2>
      <p>Get real-time liquidation data, AI predictions, and price magnet targets</p>
      <div class="gate-features">
        <div class="gate-feature"><span>‚úì</span> Live liquidation heatmap</div>
        <div class="gate-feature"><span>‚úì</span> Historical liquidation data</div>
        <div class="gate-feature"><span>‚úì</span> AI price magnet predictions</div>
        <div class="gate-feature"><span>‚úì</span> Sweep probability scores</div>
      </div>
      <div class="gate-price">
        <span class="price-amount">50 sats</span>
        <span class="price-period">one-time access</span>
      </div>
      <button class="btn-unlock" id="btn-unlock">Unlock Full Analysis</button>
    </div>
  </section>

  <!-- Education -->
  <section class="liq-education">
    <h2>Understanding Liquidations</h2>
    <div class="edu-cards">
      <div class="edu-card">
        <h3>What are Liquidations?</h3>
        <p>When traders use leverage, their position can be forcibly closed (liquidated) if the price moves against them enough to deplete their margin. These liquidations create cascading effects on price.</p>
      </div>
      <div class="edu-card">
        <h3>Why Liquidation Levels Matter</h3>
        <p>Large clusters of liquidations act as "price magnets" - the market often moves toward these zones to trigger the liquidations, creating momentum and volatility.</p>
      </div>
      <div class="edu-card">
        <h3>Trading the Heatmap</h3>
        <p>Look for zones with high liquidation density. Price often sweeps these zones before reversing. The larger the liquidation cluster, the stronger the potential reaction.</p>
      </div>
    </div>
  </section>
</div>

{{ end }}
