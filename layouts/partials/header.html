<header class="header" role="banner">
  <div class="header-content">
    <a href="/" class="logo" aria-label="BTC Signal AI - Home">
      <svg class="logo-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-6h2v2h-2zm0-8h2v6h-2z"/>
      </svg>
      <span>BTC Signal AI</span>
    </a>
    <nav role="navigation" aria-label="Main navigation">
      <ul class="nav-links" role="menubar">
        <li role="none"><a href="/" role="menuitem">Home</a></li>
        <li role="none"><a href="/posts/" role="menuitem">Analysis</a></li>
        <li role="none"><a href="/learn/" role="menuitem">Learn</a></li>
        <li class="nav-dropdown" role="none">
          <button class="dropdown-toggle" aria-expanded="false" aria-haspopup="true" aria-controls="pro-tools-menu" role="menuitem">
            Pro Tools
            <span class="sr-only">, submenu</span>
          </button>
          <ul class="dropdown-menu" id="pro-tools-menu" role="menu" aria-label="Pro Tools submenu">
            <li role="none"><a href="/alpha-radar/" role="menuitem"><span aria-hidden="true">üì°</span> Alpha Radar</a></li>
            <li role="none"><a href="/liquidity-hunter/" role="menuitem"><span aria-hidden="true">üéØ</span> Liquidity Hunter</a></li>
            <li role="none"><a href="/trade-coach/" role="menuitem"><span aria-hidden="true">üéì</span> Trade Coach</a></li>
            <li role="none"><a href="/portfolio-simulator/" role="menuitem"><span aria-hidden="true">üìà</span> Simulator</a></li>
            <li role="none"><a href="/dashboard/" role="menuitem"><span aria-hidden="true">üìä</span> Dashboard</a></li>
            <li role="none"><a href="/analyze/" role="menuitem"><span aria-hidden="true">ü§ñ</span> Chart AI</a></li>
          </ul>
        </li>
        <li role="none"><a href="/pricing/" class="nav-pricing" role="menuitem">Pricing</a></li>
        <li role="none">
          <a href="https://twitter.com/BTCSignal_ai" target="_blank" rel="noopener noreferrer" role="menuitem">
            Twitter<span class="sr-only"> (opens in new tab)</span>
          </a>
        </li>
      </ul>
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark/light theme" aria-pressed="false">
        <span class="icon icon-moon" aria-hidden="true">üåô</span>
        <span class="icon icon-sun" aria-hidden="true">‚òÄÔ∏è</span>
      </button>
    </nav>
  </div>
</header>
<script>
  // Show dashboard link if user has unlocked posts
  (function() {
    try {
      var unlocked = localStorage.getItem('unlockedPosts');
      if (unlocked) {
        var posts = JSON.parse(unlocked);
        if (Array.isArray(posts) && posts.length > 0) {
          var dashNav = document.getElementById('dashboard-nav');
          var analyzeNav = document.getElementById('analyze-nav');
          if (dashNav) dashNav.style.display = 'inline';
          if (analyzeNav) analyzeNav.style.display = 'inline';
        }
      }
    } catch (e) {}
  })();

  // Theme toggle with accessibility
  (function() {
    var toggle = document.getElementById('theme-toggle');
    var html = document.documentElement;

    // Check for saved preference or system preference
    var savedTheme = localStorage.getItem('theme');
    var systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (savedTheme) {
      html.setAttribute('data-theme', savedTheme);
      toggle.setAttribute('aria-pressed', savedTheme === 'light' ? 'true' : 'false');
    } else if (!systemPrefersDark) {
      html.setAttribute('data-theme', 'light');
      toggle.setAttribute('aria-pressed', 'true');
    }

    if (toggle) {
      toggle.addEventListener('click', function() {
        var currentTheme = html.getAttribute('data-theme');
        var newTheme = currentTheme === 'light' ? 'dark' : 'light';

        if (newTheme === 'dark') {
          html.removeAttribute('data-theme');
        } else {
          html.setAttribute('data-theme', newTheme);
        }

        toggle.setAttribute('aria-pressed', newTheme === 'light' ? 'true' : 'false');
        localStorage.setItem('theme', newTheme);

        // Announce to screen readers
        var announcement = document.createElement('div');
        announcement.setAttribute('role', 'status');
        announcement.setAttribute('aria-live', 'polite');
        announcement.className = 'sr-only';
        announcement.textContent = 'Theme changed to ' + newTheme + ' mode';
        document.body.appendChild(announcement);
        setTimeout(function() { announcement.remove(); }, 1000);
      });
    }
  })();

  // Accessible dropdown menu with keyboard support
  (function() {
    var dropdown = document.querySelector('.nav-dropdown');
    var toggle = dropdown ? dropdown.querySelector('.dropdown-toggle') : null;
    var menu = dropdown ? dropdown.querySelector('.dropdown-menu') : null;

    if (!toggle || !menu) return;

    var menuItems = menu.querySelectorAll('a[role="menuitem"]');
    var isOpen = false;

    function openMenu() {
      isOpen = true;
      toggle.setAttribute('aria-expanded', 'true');
      dropdown.classList.add('is-open');
    }

    function closeMenu() {
      isOpen = false;
      toggle.setAttribute('aria-expanded', 'false');
      dropdown.classList.remove('is-open');
    }

    // Toggle on click/Enter/Space
    toggle.addEventListener('click', function(e) {
      e.preventDefault();
      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
        menuItems[0].focus();
      }
    });

    toggle.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowDown' || e.key === 'Down') {
        e.preventDefault();
        openMenu();
        menuItems[0].focus();
      } else if (e.key === 'Escape' || e.key === 'Esc') {
        closeMenu();
        toggle.focus();
      }
    });

    // Keyboard navigation within menu
    menuItems.forEach(function(item, index) {
      item.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowDown' || e.key === 'Down') {
          e.preventDefault();
          menuItems[(index + 1) % menuItems.length].focus();
        } else if (e.key === 'ArrowUp' || e.key === 'Up') {
          e.preventDefault();
          menuItems[(index - 1 + menuItems.length) % menuItems.length].focus();
        } else if (e.key === 'Escape' || e.key === 'Esc') {
          closeMenu();
          toggle.focus();
        } else if (e.key === 'Tab') {
          closeMenu();
        }
      });
    });

    // Close on click outside
    document.addEventListener('click', function(e) {
      if (!dropdown.contains(e.target)) {
        closeMenu();
      }
    });

    // Close on focus outside
    document.addEventListener('focusin', function(e) {
      if (!dropdown.contains(e.target)) {
        closeMenu();
      }
    });
  })();
</script>
