<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>
  {{ block "title" . }}
    {{ if .Params.PageTitle}}
      {{ .Params.PageTitle }}
    {{ else }}
      {{ .Params.Title }}
    {{ end }}
  {{ end }}
</title>

<!-- metatags -->
{{ partial "seo_schema" . }}

<!-- Favicon -->
<link rel="apple-touch-icon" href="{{ "apple-touch-icon.png" | relURL }}" sizes="180x180">
<link rel="icon" href="{{ "favicon-32x32.png" | relURL }}" sizes="32x32" type="image/png">
<link rel="icon" href="{{ "favicon-16x16.png" | relURL }}" sizes="16x16" type="image/png">
<meta name="msapplication-TileColor" content="#f7931a">
<meta name="theme-color" content="#0d1117">

<!-- PWA Manifest -->
<link rel="manifest" href="{{ "manifest.json" | relURL }}">

<!-- iOS PWA Support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="BTC Signals">

<!-- Android PWA Support -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="application-name" content="BTC Signals">

<!-- OG Image dimensions -->
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<!-- CSS -->
<link rel="stylesheet" href="{{ "src/css/bootstrap/bootstrap.min.css" | relURL }}">

{{/* Load shared CSS - loaded on every page */}}
<link rel="stylesheet" href="{{ "src/css/shared.css" | relURL }}">

{{/* Load page-specific CSS from frontmatter */}}
{{ range .Params.css }}
  {{ $cssFile := . }}
  {{/* Convert .scss extension to .css for compiled files */}}
  {{ if strings.HasSuffix $cssFile ".scss" }}
    {{ $cssFile = replace $cssFile ".scss" ".css" }}
  {{ end }}
  <link rel="stylesheet" href="{{ "src/css/" | relURL }}{{ $cssFile }}">
{{ end }}

{{/* Auto-load single-post.css for individual post pages */}}
{{ if and (eq .Section "posts") .IsPage }}
  <link rel="stylesheet" href="{{ "src/css/single-post.css" | relURL }}">
{{ end }}

<!-- Critical: Access manager loads sync for paywall check -->
<script src="{{ "src/js/access-manager.js" | relURL }}"></script>
<!-- Error tracking - loads early to catch all errors -->
<script src="{{ "src/js/error-tracker.js" | relURL }}"></script>
<!-- Toast can defer - only used after user interactions -->
<script defer src="{{ "src/js/toast.js" | relURL }}"></script>

<!-- canonical -->
{{ if not .Params.canonical }}
  <link rel="canonical" href="{{ .Permalink }}">
{{ end }}

<!-- fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"/>
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet" media="print" onload="this.media='all'"/>
<noscript>
  <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet"/>
</noscript>


<!-- script -->
<script defer src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
{{/* site.js removed - file does not exist */}}
<!-- Font Awesome - defer for performance -->
<script defer src="https://kit.fontawesome.com/902c9ed551.js" crossorigin="anonymous"></script>


<script src="https://zerotrustanalytics.netlify.app/js/analytics.js" data-site-id="site_08322ca6924fa56a"></script>

<!-- Service Worker Registration -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/sw.js')
        .then(function(registration) {
          console.log('Service Worker registered successfully:', registration.scope);

          // Check for updates periodically
          setInterval(function() {
            registration.update();
          }, 60000); // Check every minute

          // Handle service worker updates
          registration.addEventListener('updatefound', function() {
            const newWorker = registration.installing;

            newWorker.addEventListener('statechange', function() {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // New service worker available, show update notification
                console.log('New service worker available! Refresh to update.');

                // Optional: Auto-reload on update (comment out if you want manual control)
                if (confirm('A new version of BTC Signals is available. Reload to update?')) {
                  newWorker.postMessage({ type: 'SKIP_WAITING' });
                  window.location.reload();
                }
              }
            });
          });
        })
        .catch(function(error) {
          console.log('Service Worker registration failed:', error);
        });

      // Handle controller change (new service worker activated)
      navigator.serviceWorker.addEventListener('controllerchange', function() {
        window.location.reload();
      });
    });
  }
</script>