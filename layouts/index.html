{{ define "main" }}
<div class="container">
  <header class="hero-section">
    <h1 class="site-title">Bitcoin Analysis Bot</h1>
    <p class="site-description">Automated technical analysis powered by AI</p>

    <div class="live-ticker" id="btc-ticker" role="status" aria-live="polite" aria-label="Live Bitcoin price">
      <span class="ticker-label">BTC/USD</span>
      <span class="ticker-price" id="btc-price" aria-label="Current Bitcoin price">Loading...</span>
      <span class="ticker-change" id="btc-change" aria-label="24 hour price change"></span>
    </div>
  </header>

  <!-- Quick Stats Bar -->
  <section class="quick-stats-bar" aria-label="Quick market statistics">
    <div class="quick-stat">
      <span class="quick-stat-label">24h High</span>
      <span class="quick-stat-value" id="stat-high">--</span>
    </div>
    <div class="quick-stat">
      <span class="quick-stat-label">24h Low</span>
      <span class="quick-stat-value" id="stat-low">--</span>
    </div>
    <div class="quick-stat">
      <span class="quick-stat-label">24h Volume</span>
      <span class="quick-stat-value" id="stat-volume">--</span>
    </div>
    <div class="quick-stat">
      <span class="quick-stat-label">Market Cap</span>
      <span class="quick-stat-value" id="stat-mcap">--</span>
    </div>
  </section>

  <!-- Hero Feature Cards - Above the Fold -->
  <section class="hero-features" aria-labelledby="features-heading">
    <h2 id="features-heading" class="sr-only">Key Features</h2>
    <div class="hero-features-grid">
      <!-- AI Signal Card -->
      <article class="hero-feature-card signal-card">
        <div class="hero-feature-icon">ü§ñ</div>
        <div class="hero-feature-content">
          <h3>Latest AI Signal</h3>
          {{ $latestPost := index (where .Site.RegularPages "Section" "posts") 0 }}
          {{ if $latestPost }}
          <div class="signal-display">
            <span class="signal-direction {{ $latestPost.Params.direction }}">
              {{ if eq $latestPost.Params.direction "up" }}üìà BULLISH{{ else if eq $latestPost.Params.direction "down" }}üìâ BEARISH{{ else }}‚û°Ô∏è NEUTRAL{{ end }}
            </span>
            <span class="signal-confidence">{{ $latestPost.Params.confidence }}% Confidence</span>
          </div>
          <p class="signal-time">{{ $latestPost.Date.Format "Jan 02, 15:04 UTC" }}</p>
          <a href="{{ $latestPost.Permalink }}" class="hero-feature-link">View Analysis ‚Üí</a>
          {{ else }}
          <p class="signal-pending">Generating first signal...</p>
          {{ end }}
        </div>
      </article>

      <!-- Key Level Card -->
      <article class="hero-feature-card level-card">
        <div class="hero-feature-icon">üéØ</div>
        <div class="hero-feature-content">
          <h3>Key Level of the Day</h3>
          <div class="key-level-display">
            <span class="key-level-value" id="hero-key-level">Loading...</span>
            <span class="key-level-badge" id="hero-level-type">--</span>
          </div>
          <p class="key-level-note" id="hero-level-desc">Calculating...</p>
          <a href="/embed/key-level/" class="hero-feature-link">Embed Widget ‚Üí</a>
        </div>
      </article>

      <!-- Funding Rate Quick Card -->
      <article class="hero-feature-card funding-card">
        <div class="hero-feature-icon">üí∞</div>
        <div class="hero-feature-content">
          <h3>BTC Funding Rate</h3>
          <div class="funding-quick-display">
            <span class="funding-quick-value" id="hero-funding-value">--</span>
            <span class="funding-quick-label" id="hero-funding-label">Loading...</span>
          </div>
          <p class="funding-quick-note">8hr perpetual rate</p>
        </div>
      </article>

      <!-- Pro Tools CTA Card -->
      <article class="hero-feature-card cta-card">
        <div class="hero-feature-icon">‚ö°</div>
        <div class="hero-feature-content">
          <h3>Pro Trading Tools</h3>
          <ul class="pro-tools-list">
            <li>üìä Pattern Detector</li>
            <li>üî• Liquidation Hunter</li>
            <li>üß† AI Trade Coach</li>
          </ul>
          <a href="/pro-tools/dashboard/" class="hero-feature-link highlight">Explore Tools ‚Üí</a>
        </div>
      </article>
    </div>
  </section>

  <!-- 3D Bitcoin Coin - Moved below features -->
  <div class="bitcoin-coin-section">
    <div class="bitcoin-coin-container" role="img" aria-label="Interactive 3D Bitcoin coin animation">
      <div id="bitcoin-coin"></div>
    </div>
  </div>

  <!-- Market Sentiment Overview (FREE) -->
  <section class="market-sentiment-section" aria-labelledby="sentiment-heading">
    <h2 id="sentiment-heading">Market Sentiment</h2>
    <p class="section-desc">Real-time market indicators and sentiment metrics</p>
    <div class="sentiment-overview-grid" role="list">
      <!-- Fear & Greed Index -->
      <article class="sentiment-overview-card fng" role="listitem">
        <div class="sentiment-overview-header">
          <span class="sentiment-overview-icon" aria-hidden="true">üò±</span>
          <h3>Fear & Greed</h3>
        </div>
        <div class="fng-meter">
          <div class="fng-value-large" id="home-fng-value">--</div>
          <div class="fng-label-text" id="home-fng-label">Loading...</div>
          <div class="fng-bar-wrapper">
            <div class="fng-gradient-bar">
              <div class="fng-indicator" id="home-fng-indicator"></div>
            </div>
            <div class="fng-labels">
              <span>Fear</span>
              <span>Greed</span>
            </div>
          </div>
        </div>
      </article>

      <!-- Funding Rate -->
      <article class="sentiment-overview-card funding" role="listitem">
        <div class="sentiment-overview-header">
          <span class="sentiment-overview-icon" aria-hidden="true">üí∞</span>
          <h3>Funding Rate</h3>
        </div>
        <div class="funding-meter">
          <div class="funding-value-large" id="home-funding-value">--</div>
          <div class="funding-label-text" id="home-funding-label">Loading...</div>
          <div class="funding-bar-wrapper">
            <div class="funding-bar">
              <div class="funding-center-line"></div>
              <div class="funding-fill" id="home-funding-fill"></div>
            </div>
            <div class="funding-labels">
              <span>Shorts Pay</span>
              <span>Longs Pay</span>
            </div>
          </div>
        </div>
        <p class="funding-note">8hr perpetual rate</p>
      </article>

      <!-- Volume Profile Snapshot -->
      <article class="sentiment-overview-card volume" role="listitem">
        <div class="sentiment-overview-header">
          <span class="sentiment-overview-icon" aria-hidden="true">üìä</span>
          <h3>24H Volume Profile</h3>
        </div>
        <div class="volume-snapshot">
          <div class="volume-bars" id="home-volume-bars">
            <!-- Generated by JS -->
          </div>
          <div class="volume-stats">
            <div class="volume-stat">
              <span class="vol-label">Buy Vol</span>
              <span class="vol-value buy" id="home-buy-vol">--</span>
            </div>
            <div class="volume-stat">
              <span class="vol-label">Sell Vol</span>
              <span class="vol-value sell" id="home-sell-vol">--</span>
            </div>
            <div class="volume-stat">
              <span class="vol-label">Ratio</span>
              <span class="vol-value" id="home-vol-ratio">--</span>
            </div>
          </div>
        </div>
      </article>

      <!-- Liquidation Heatmap Thumbnail -->
      <article class="sentiment-overview-card liquidation" role="listitem">
        <div class="sentiment-overview-header">
          <span class="sentiment-overview-icon" aria-hidden="true">üî•</span>
          <h3>Liquidation Zones</h3>
        </div>
        <div class="liq-heatmap-thumbnail">
          <div class="liq-heatmap-chart" id="home-liq-heatmap">
            <!-- Generated by JS - mini heatmap -->
          </div>
          <div class="liq-levels-mini">
            <div class="liq-level-item above">
              <span class="liq-arrow">‚Üë</span>
              <span class="liq-price" id="home-liq-above">--</span>
              <span class="liq-tag">Shorts liquidated</span>
            </div>
            <div class="liq-level-item current">
              <span class="liq-current-label">Current</span>
              <span class="liq-price" id="home-liq-current">--</span>
            </div>
            <div class="liq-level-item below">
              <span class="liq-arrow">‚Üì</span>
              <span class="liq-price" id="home-liq-below">--</span>
              <span class="liq-tag">Longs liquidated</span>
            </div>
          </div>
        </div>
      </article>
    </div>
  </section>

  <!-- BTC Narrative Tracker (FREE) -->
  <section class="narrative-section" aria-labelledby="fundamentals-heading">
    <h2 id="fundamentals-heading">Bitcoin Fundamentals</h2>
    <p class="section-desc">Real-time on-chain and market metrics</p>
    <div class="narrative-grid" role="list">
      <!-- Halving Countdown -->
      <article class="narrative-card halving" role="listitem">
        <div class="narrative-icon" aria-hidden="true">‚è∞</div>
        <h3>Next Halving</h3>
        <div class="countdown" id="halving-countdown" aria-label="Time until next Bitcoin halving">
          <div class="countdown-item">
            <span class="countdown-value" id="halving-days">--</span>
            <span class="countdown-label">Days</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-value" id="halving-hours">--</span>
            <span class="countdown-label">Hours</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-value" id="halving-mins">--</span>
            <span class="countdown-label">Mins</span>
          </div>
        </div>
        <p class="narrative-note">Block <span id="halving-block">1,050,000</span> ‚Ä¢ ~April 2028</p>
      </article>

      <!-- Hash Rate -->
      <article class="narrative-card hashrate" role="listitem">
        <div class="narrative-icon" aria-hidden="true">‚õèÔ∏è</div>
        <h3>Network Hash Rate</h3>
        <div class="metric-display">
          <span class="metric-value" id="hash-rate">--</span>
          <span class="metric-unit">EH/s</span>
        </div>
        <p class="narrative-note" id="hash-change">Loading...</p>
      </article>

      <!-- Market Cap -->
      <article class="narrative-card mcap" role="listitem">
        <div class="narrative-icon" aria-hidden="true">üíé</div>
        <h3>Market Cap</h3>
        <div class="metric-display">
          <span class="metric-value" id="market-cap">--</span>
          <span class="metric-unit">T</span>
        </div>
        <p class="narrative-note">BTC Dominance: <span id="btc-dominance">--</span>%</p>
      </article>

      <!-- ETF Flows -->
      <article class="narrative-card etf" role="listitem">
        <div class="narrative-icon" aria-hidden="true">üè¶</div>
        <h3>ETF Sentiment</h3>
        <div class="etf-indicator" id="etf-indicator">
          <span class="etf-status">Tracking</span>
        </div>
        <p class="narrative-note">Spot BTC ETF flow tracker</p>
      </article>
    </div>
  </section>

  <section class="latest-analysis" aria-labelledby="latest-heading">
    <h2 id="latest-heading">Latest Analysis</h2>
    <div class="posts-grid" role="list">
      {{ $allPosts := where .Site.RegularPages "Section" "posts" }}
      {{ range $index, $post := first 6 $allPosts }}
      {{ $isLocked := lt $index 10 }}
      <a href="{{ $post.Permalink }}" class="post-card {{ $post.Params.direction }}{{ if $isLocked }} locked{{ end }}" role="listitem" aria-label="Analysis from {{ $post.Date.Format "January 2, 2006" }}: {{ $post.Params.direction }} signal with {{ $post.Params.confidence }} percent confidence at ${{ $post.Params.price }}{{ if $isLocked }}, requires payment{{ end }}">
        <div class="post-card-header">
          <span class="post-date">{{ $post.Date.Format "Jan 02, 15:04" }}</span>
          <span class="post-timeframe">{{ $post.Params.timeframe }}</span>
          {{ if $isLocked }}<span class="lock-badge" aria-hidden="true"><span aria-hidden="true">‚ö°</span> 21 sats</span>{{ end }}
        </div>
        <div class="post-card-body">
          <span class="direction-badge {{ $post.Params.direction }}">
            <span aria-hidden="true">{{ if eq $post.Params.direction "up" }}üìà{{ else if eq $post.Params.direction "down" }}üìâ{{ else }}‚û°Ô∏è{{ end }}</span>
            {{ upper $post.Params.direction }}
          </span>
          <span class="confidence">{{ $post.Params.confidence }}%<span class="sr-only"> confidence</span></span>
        </div>
        <div class="post-card-footer">
          <span class="price">${{ $post.Params.price }}</span>
        </div>
      </a>
      {{ end }}
    </div>
  </section>

  <section class="free-posts" aria-labelledby="free-heading">
    <h2 id="free-heading">Free Analysis</h2>
    <p class="section-desc">Explore our historical analysis - no payment required</p>
    <div class="posts-grid" role="list">
      {{ $allPosts := where .Site.RegularPages "Section" "posts" }}
      {{ range $index, $post := after 10 $allPosts }}
      {{ if lt $index 6 }}
      <a href="{{ $post.Permalink }}" class="post-card {{ $post.Params.direction }}" role="listitem" aria-label="Free analysis from {{ $post.Date.Format "January 2, 2006" }}: {{ $post.Params.direction }} signal with {{ $post.Params.confidence }} percent confidence at ${{ $post.Params.price }}">
        <div class="post-card-header">
          <span class="post-date">{{ $post.Date.Format "Jan 02, 15:04" }}</span>
          <span class="post-timeframe">{{ $post.Params.timeframe }}</span>
          <span class="free-badge"><span aria-hidden="true">‚úì</span> Free</span>
        </div>
        <div class="post-card-body">
          <span class="direction-badge {{ $post.Params.direction }}">
            <span aria-hidden="true">{{ if eq $post.Params.direction "up" }}üìà{{ else if eq $post.Params.direction "down" }}üìâ{{ else }}‚û°Ô∏è{{ end }}</span>
            {{ upper $post.Params.direction }}
          </span>
          <span class="confidence">{{ $post.Params.confidence }}%<span class="sr-only"> confidence</span></span>
        </div>
        <div class="post-card-footer">
          <span class="price">${{ $post.Params.price }}</span>
        </div>
      </a>
      {{ end }}
      {{ end }}
    </div>
  </section>


  <!-- Backtest Snippets (Free Teasers) -->
  <section class="backtest-section" aria-labelledby="backtest-heading">
    <h2 id="backtest-heading">Strategy Backtests</h2>
    <p class="section-desc">See how common strategies performed on BTC</p>
    <div class="backtest-grid" role="list">
      <article class="backtest-card" role="listitem">
        <div class="backtest-header">
          <span class="backtest-icon" aria-hidden="true">üìä</span>
          <h3>EMA Cross (9/21)</h3>
        </div>
        <div class="backtest-stats">
          <div class="backtest-stat">
            <span class="stat-value win">67%</span>
            <span class="stat-label">Win Rate</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">1.8R</span>
            <span class="stat-label">Avg Win</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">142</span>
            <span class="stat-label">Trades</span>
          </div>
        </div>
        <p class="backtest-period">1H timeframe ‚Ä¢ Last 6 months</p>
      </article>

      <article class="backtest-card" role="listitem">
        <div class="backtest-header">
          <span class="backtest-icon" aria-hidden="true">üìà</span>
          <h3>RSI Divergence</h3>
        </div>
        <div class="backtest-stats">
          <div class="backtest-stat">
            <span class="stat-value win">72%</span>
            <span class="stat-label">Win Rate</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">2.1R</span>
            <span class="stat-label">Avg Win</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">48</span>
            <span class="stat-label">Trades</span>
          </div>
        </div>
        <p class="backtest-period">4H timeframe ‚Ä¢ Last 6 months</p>
      </article>

      <article class="backtest-card" role="listitem">
        <div class="backtest-header">
          <span class="backtest-icon" aria-hidden="true">üéØ</span>
          <h3>VWAP Bounce</h3>
        </div>
        <div class="backtest-stats">
          <div class="backtest-stat">
            <span class="stat-value win">61%</span>
            <span class="stat-label">Win Rate</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">1.5R</span>
            <span class="stat-label">Avg Win</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">89</span>
            <span class="stat-label">Trades</span>
          </div>
        </div>
        <p class="backtest-period">1H timeframe ‚Ä¢ Last 6 months</p>
      </article>

      <article class="backtest-card premium-teaser" role="listitem">
        <div class="backtest-header">
          <span class="backtest-icon" aria-hidden="true">üöÄ</span>
          <h3>Portfolio Simulator</h3>
        </div>
        <p class="premium-text">Run full backtests with equity curves, Sharpe ratio, and AI insights</p>
        <a href="/portfolio-simulator/" class="btn-unlock">Try Simulator</a>
      </article>

      <article class="backtest-card premium-teaser" role="listitem">
        <div class="backtest-header">
          <span class="backtest-icon" aria-hidden="true">üîí</span>
          <h3>Backtester PRO</h3>
        </div>
        <p class="premium-text">AI-powered custom strategies with detailed trade-by-trade analysis</p>
        <a href="/pricing/" class="btn-unlock">Coming Soon</a>
      </article>
    </div>
  </section>

  <section class="all-posts" aria-labelledby="all-posts-heading">
    <h2 id="all-posts-heading">All Analysis</h2>
    <div class="posts-list" role="list">
      {{ $allPosts := where .Site.RegularPages "Section" "posts" }}
      {{ range $index, $post := $allPosts }}
      {{ $isLocked := lt $index 10 }}
      <a href="{{ $post.Permalink }}" class="post-row {{ $post.Params.direction }}{{ if $isLocked }} locked{{ end }}" role="listitem" aria-label="Analysis from {{ $post.Date.Format "January 2, 2006" }}: {{ $post.Params.direction }} signal, {{ $post.Params.confidence }} percent confidence, ${{ $post.Params.price }}{{ if $isLocked }}, premium content{{ else }}, free{{ end }}">
        <span class="post-date">{{ $post.Date.Format "2006-01-02 15:04" }}</span>
        <span class="direction-indicator {{ $post.Params.direction }}" aria-hidden="true">
          {{ if eq $post.Params.direction "up" }}üìà{{ else if eq $post.Params.direction "down" }}üìâ{{ else }}‚û°Ô∏è{{ end }}
        </span>
        <span class="direction-text">{{ upper $post.Params.direction }}</span>
        <span class="confidence">{{ $post.Params.confidence }}%</span>
        <span class="price">${{ $post.Params.price }}</span>
        {{ if $isLocked }}<span class="lock-badge" aria-hidden="true">üîí</span>{{ else }}<span class="free-badge"><span aria-hidden="true">‚úì</span> Free</span>{{ end }}
      </a>
      {{ end }}
    </div>
  </section>
</div>

<!-- Three.js for 3D coin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="{{ "src/js/bitcoin-coin.js" | relURL }}"></script>
<script src="{{ "src/js/narrative-tracker.js" | relURL }}"></script>
<script src="{{ "src/js/key-level.js" | relURL }}"></script>
<script src="{{ "src/js/market-sentiment.js" | relURL }}"></script>

<!-- Live price ticker -->
<script>
async function updatePrice() {
  try {
    const res = await fetch('https://api.coinbase.com/v2/prices/BTC-USD/spot');
    const data = await res.json();
    const price = parseFloat(data.data.amount);
    document.getElementById('btc-price').textContent = '$' + price.toLocaleString(undefined, {maximumFractionDigits: 0});
  } catch (e) {
    document.getElementById('btc-price').textContent = 'Error';
  }
}
updatePrice();
setInterval(updatePrice, 30000);
</script>
{{ end }}
