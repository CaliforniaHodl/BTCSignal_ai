{{ define "main" }}
<div class="container">
  <header class="hero-section">
    <h1 class="site-title">Bitcoin Analysis Bot</h1>
    <p class="site-description">Automated technical analysis powered by AI</p>

    <!-- 3D Bitcoin Coin -->
    <div class="bitcoin-coin-container">
      <div id="bitcoin-coin"></div>
    </div>

    <div class="live-ticker" id="btc-ticker">
      <span class="ticker-label">BTC/USD</span>
      <span class="ticker-price" id="btc-price">Loading...</span>
      <span class="ticker-change" id="btc-change"></span>
    </div>
  </header>

  <section class="latest-analysis">
    <h2>Latest Analysis</h2>
    <div class="posts-grid">
      {{ $allPosts := where .Site.RegularPages "Section" "posts" }}
      {{ range $index, $post := first 6 $allPosts }}
      {{ $isLocked := lt $index 10 }}
      <a href="{{ $post.Permalink }}" class="post-card {{ $post.Params.direction }}{{ if $isLocked }} locked{{ end }}">
        <div class="post-card-header">
          <span class="post-date">{{ $post.Date.Format "Jan 02, 15:04" }}</span>
          <span class="post-timeframe">{{ $post.Params.timeframe }}</span>
          {{ if $isLocked }}<span class="lock-badge">‚ö° 21 sats</span>{{ end }}
        </div>
        <div class="post-card-body">
          <span class="direction-badge {{ $post.Params.direction }}">
            {{ if eq $post.Params.direction "up" }}üìà{{ else if eq $post.Params.direction "down" }}üìâ{{ else }}‚û°Ô∏è{{ end }}
            {{ upper $post.Params.direction }}
          </span>
          <span class="confidence">{{ $post.Params.confidence }}%</span>
        </div>
        <div class="post-card-footer">
          <span class="price">${{ $post.Params.price }}</span>
        </div>
      </a>
      {{ end }}
    </div>
  </section>

  <section class="all-posts">
    <h2>All Analysis</h2>
    <div class="posts-list">
      {{ $allPosts := where .Site.RegularPages "Section" "posts" }}
      {{ range $index, $post := $allPosts }}
      {{ $isLocked := lt $index 10 }}
      <a href="{{ $post.Permalink }}" class="post-row {{ $post.Params.direction }}{{ if $isLocked }} locked{{ end }}">
        <span class="post-date">{{ $post.Date.Format "2006-01-02 15:04" }}</span>
        <span class="direction-indicator {{ $post.Params.direction }}">
          {{ if eq $post.Params.direction "up" }}üìà{{ else if eq $post.Params.direction "down" }}üìâ{{ else }}‚û°Ô∏è{{ end }}
        </span>
        <span class="direction-text">{{ upper $post.Params.direction }}</span>
        <span class="confidence">{{ $post.Params.confidence }}%</span>
        <span class="price">${{ $post.Params.price }}</span>
        {{ if $isLocked }}<span class="lock-badge">üîí</span>{{ end }}
      </a>
      {{ end }}
    </div>
  </section>
</div>

<!-- Three.js for 3D coin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="{{ "src/js/bitcoin-coin.js" | relURL }}"></script>

<!-- Live price ticker -->
<script>
async function updatePrice() {
  try {
    const res = await fetch('https://api.coinbase.com/v2/prices/BTC-USD/spot');
    const data = await res.json();
    const price = parseFloat(data.data.amount);
    document.getElementById('btc-price').textContent = '$' + price.toLocaleString(undefined, {maximumFractionDigits: 0});
  } catch (e) {
    document.getElementById('btc-price').textContent = 'Error';
  }
}
updatePrice();
setInterval(updatePrice, 30000);
</script>
{{ end }}
