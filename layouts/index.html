{{ define "main" }}
<div class="container">
  <header class="hero-section">
    <h1 class="site-title">Bitcoin Analysis Bot</h1>
    <p class="site-description">Automated technical analysis powered by AI</p>

    <!-- 3D Bitcoin Coin -->
    <div class="bitcoin-coin-container">
      <div id="bitcoin-coin"></div>
    </div>

    <div class="live-ticker" id="btc-ticker">
      <span class="ticker-label">BTC/USD</span>
      <span class="ticker-price" id="btc-price">Loading...</span>
      <span class="ticker-change" id="btc-change"></span>
    </div>

    <!-- Key Level of the Day Widget -->
    <div class="key-level-widget" id="key-level-widget">
      <div class="key-level-header">
        <span class="key-level-title">Key Level of the Day</span>
        <span class="key-level-type" id="level-type">--</span>
      </div>
      <div class="key-level-price" id="key-level-price">Loading...</div>
      <div class="key-level-desc" id="key-level-desc">Calculating key level...</div>
      <div class="key-level-distance" id="key-level-distance"></div>
    </div>
  </header>

  <!-- BTC Narrative Tracker (FREE) -->
  <section class="narrative-section">
    <h2>Bitcoin Fundamentals</h2>
    <p class="section-desc">Real-time on-chain and market metrics</p>
    <div class="narrative-grid">
      <!-- Halving Countdown -->
      <div class="narrative-card halving">
        <div class="narrative-icon">‚è∞</div>
        <h3>Next Halving</h3>
        <div class="countdown" id="halving-countdown">
          <div class="countdown-item">
            <span class="countdown-value" id="halving-days">--</span>
            <span class="countdown-label">Days</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-value" id="halving-hours">--</span>
            <span class="countdown-label">Hours</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-value" id="halving-mins">--</span>
            <span class="countdown-label">Mins</span>
          </div>
        </div>
        <p class="narrative-note">Block <span id="halving-block">1,050,000</span> ‚Ä¢ ~April 2028</p>
      </div>

      <!-- Hash Rate -->
      <div class="narrative-card hashrate">
        <div class="narrative-icon">‚õèÔ∏è</div>
        <h3>Network Hash Rate</h3>
        <div class="metric-display">
          <span class="metric-value" id="hash-rate">--</span>
          <span class="metric-unit">EH/s</span>
        </div>
        <p class="narrative-note" id="hash-change">Loading...</p>
      </div>

      <!-- Market Cap -->
      <div class="narrative-card mcap">
        <div class="narrative-icon">üíé</div>
        <h3>Market Cap</h3>
        <div class="metric-display">
          <span class="metric-value" id="market-cap">--</span>
          <span class="metric-unit">T</span>
        </div>
        <p class="narrative-note">BTC Dominance: <span id="btc-dominance">--</span>%</p>
      </div>

      <!-- ETF Flows -->
      <div class="narrative-card etf">
        <div class="narrative-icon">üè¶</div>
        <h3>ETF Sentiment</h3>
        <div class="etf-indicator" id="etf-indicator">
          <span class="etf-status">Tracking</span>
        </div>
        <p class="narrative-note">Spot BTC ETF flow tracker</p>
      </div>
    </div>
  </section>

  <section class="latest-analysis">
    <h2>Latest Analysis</h2>
    <div class="posts-grid">
      {{ $allPosts := where .Site.RegularPages "Section" "posts" }}
      {{ range $index, $post := first 6 $allPosts }}
      {{ $isLocked := lt $index 10 }}
      <a href="{{ $post.Permalink }}" class="post-card {{ $post.Params.direction }}{{ if $isLocked }} locked{{ end }}">
        <div class="post-card-header">
          <span class="post-date">{{ $post.Date.Format "Jan 02, 15:04" }}</span>
          <span class="post-timeframe">{{ $post.Params.timeframe }}</span>
          {{ if $isLocked }}<span class="lock-badge">‚ö° 21 sats</span>{{ end }}
        </div>
        <div class="post-card-body">
          <span class="direction-badge {{ $post.Params.direction }}">
            {{ if eq $post.Params.direction "up" }}üìà{{ else if eq $post.Params.direction "down" }}üìâ{{ else }}‚û°Ô∏è{{ end }}
            {{ upper $post.Params.direction }}
          </span>
          <span class="confidence">{{ $post.Params.confidence }}%</span>
        </div>
        <div class="post-card-footer">
          <span class="price">${{ $post.Params.price }}</span>
        </div>
      </a>
      {{ end }}
    </div>
  </section>

  <section class="free-posts">
    <h2>Free Analysis</h2>
    <p class="section-desc">Explore our historical analysis - no payment required</p>
    <div class="posts-grid">
      {{ $allPosts := where .Site.RegularPages "Section" "posts" }}
      {{ range $index, $post := after 10 $allPosts }}
      {{ if lt $index 6 }}
      <a href="{{ $post.Permalink }}" class="post-card {{ $post.Params.direction }}">
        <div class="post-card-header">
          <span class="post-date">{{ $post.Date.Format "Jan 02, 15:04" }}</span>
          <span class="post-timeframe">{{ $post.Params.timeframe }}</span>
          <span class="free-badge">‚úì Free</span>
        </div>
        <div class="post-card-body">
          <span class="direction-badge {{ $post.Params.direction }}">
            {{ if eq $post.Params.direction "up" }}üìà{{ else if eq $post.Params.direction "down" }}üìâ{{ else }}‚û°Ô∏è{{ end }}
            {{ upper $post.Params.direction }}
          </span>
          <span class="confidence">{{ $post.Params.confidence }}%</span>
        </div>
        <div class="post-card-footer">
          <span class="price">${{ $post.Params.price }}</span>
        </div>
      </a>
      {{ end }}
      {{ end }}
    </div>
  </section>


  <!-- Backtest Snippets (Free Teasers) -->
  <section class="backtest-section">
    <h2>Strategy Backtests</h2>
    <p class="section-desc">See how common strategies performed on BTC</p>
    <div class="backtest-grid">
      <div class="backtest-card">
        <div class="backtest-header">
          <span class="backtest-icon">üìä</span>
          <h3>EMA Cross (9/21)</h3>
        </div>
        <div class="backtest-stats">
          <div class="backtest-stat">
            <span class="stat-value win">67%</span>
            <span class="stat-label">Win Rate</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">1.8R</span>
            <span class="stat-label">Avg Win</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">142</span>
            <span class="stat-label">Trades</span>
          </div>
        </div>
        <p class="backtest-period">1H timeframe ‚Ä¢ Last 6 months</p>
      </div>

      <div class="backtest-card">
        <div class="backtest-header">
          <span class="backtest-icon">üìà</span>
          <h3>RSI Divergence</h3>
        </div>
        <div class="backtest-stats">
          <div class="backtest-stat">
            <span class="stat-value win">72%</span>
            <span class="stat-label">Win Rate</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">2.1R</span>
            <span class="stat-label">Avg Win</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">48</span>
            <span class="stat-label">Trades</span>
          </div>
        </div>
        <p class="backtest-period">4H timeframe ‚Ä¢ Last 6 months</p>
      </div>

      <div class="backtest-card">
        <div class="backtest-header">
          <span class="backtest-icon">üéØ</span>
          <h3>VWAP Bounce</h3>
        </div>
        <div class="backtest-stats">
          <div class="backtest-stat">
            <span class="stat-value win">61%</span>
            <span class="stat-label">Win Rate</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">1.5R</span>
            <span class="stat-label">Avg Win</span>
          </div>
          <div class="backtest-stat">
            <span class="stat-value">89</span>
            <span class="stat-label">Trades</span>
          </div>
        </div>
        <p class="backtest-period">1H timeframe ‚Ä¢ Last 6 months</p>
      </div>

      <div class="backtest-card premium-teaser">
        <div class="backtest-header">
          <span class="backtest-icon">üîí</span>
          <h3>Custom Backtests</h3>
        </div>
        <p class="premium-text">Unlock premium to run custom strategy backtests with full reports</p>
        <a href="/posts/" class="btn-unlock">Unlock Premium</a>
      </div>
    </div>
  </section>

  <section class="all-posts">
    <h2>All Analysis</h2>
    <div class="posts-list">
      {{ $allPosts := where .Site.RegularPages "Section" "posts" }}
      {{ range $index, $post := $allPosts }}
      {{ $isLocked := lt $index 10 }}
      <a href="{{ $post.Permalink }}" class="post-row {{ $post.Params.direction }}{{ if $isLocked }} locked{{ end }}">
        <span class="post-date">{{ $post.Date.Format "2006-01-02 15:04" }}</span>
        <span class="direction-indicator {{ $post.Params.direction }}">
          {{ if eq $post.Params.direction "up" }}üìà{{ else if eq $post.Params.direction "down" }}üìâ{{ else }}‚û°Ô∏è{{ end }}
        </span>
        <span class="direction-text">{{ upper $post.Params.direction }}</span>
        <span class="confidence">{{ $post.Params.confidence }}%</span>
        <span class="price">${{ $post.Params.price }}</span>
        {{ if $isLocked }}<span class="lock-badge">üîí</span>{{ else }}<span class="free-badge">‚úì Free</span>{{ end }}
      </a>
      {{ end }}
    </div>
  </section>
</div>

<!-- Three.js for 3D coin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="{{ "src/js/bitcoin-coin.js" | relURL }}"></script>
<script src="{{ "src/js/narrative-tracker.js" | relURL }}"></script>
<script src="{{ "src/js/key-level.js" | relURL }}"></script>

<!-- Live price ticker -->
<script>
async function updatePrice() {
  try {
    const res = await fetch('https://api.coinbase.com/v2/prices/BTC-USD/spot');
    const data = await res.json();
    const price = parseFloat(data.data.amount);
    document.getElementById('btc-price').textContent = '$' + price.toLocaleString(undefined, {maximumFractionDigits: 0});
  } catch (e) {
    document.getElementById('btc-price').textContent = 'Error';
  }
}
updatePrice();
setInterval(updatePrice, 30000);
</script>
{{ end }}
