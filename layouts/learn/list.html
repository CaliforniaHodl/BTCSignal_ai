{{ define "main" }}
<div class="container learn-page">
  <header class="learn-header">
    <h1>Learn Trading</h1>
    <p class="subtitle">Free educational resources for Bitcoin traders</p>
  </header>

  <!-- Filters -->
  <div class="learn-filters">
    <!-- Category Filter -->
    <div class="category-filter">
      <div class="filter-label">Category:</div>
      <div class="filter-buttons">
        <button class="filter-btn active" data-category="all">All</button>
      {{- $categories := slice -}}
      {{- range .Pages -}}
        {{- if .Params.category -}}
          {{- $categories = $categories | append .Params.category -}}
        {{- end -}}
      {{- end -}}
      {{- $uniqueCategories := uniq $categories -}}
      {{- range $uniqueCategories -}}
      <button class="filter-btn" data-category="{{ . }}">
        {{- if eq . "fundamentals" }}Fundamentals
        {{- else if eq . "technical" }}Technical Analysis
        {{- else if eq . "derivatives" }}Derivatives
        {{- else if eq . "risk-management" }}Risk Management
        {{- else if eq . "risk" }}Risk Management
        {{- else if eq . "advanced" }}Advanced
        {{- else if eq . "strategies" }}Strategies
        {{- else if eq . "sentiment" }}Sentiment
        {{- else if eq . "psychology" }}Psychology
        {{- else if eq . "on-chain" }}On-Chain
        {{- else }}{{ . | title }}
        {{- end -}}
      </button>
      {{- end }}
    </div>
  </div>

  <!-- Difficulty Filter -->
  <div class="difficulty-filter">
    <div class="filter-label">Level:</div>
    <div class="filter-buttons">
      <button class="diff-btn active" data-difficulty="all">All</button>
      <button class="diff-btn" data-difficulty="beginner">Beginner</button>
      <button class="diff-btn" data-difficulty="intermediate">Intermediate</button>
      <button class="diff-btn" data-difficulty="advanced">Advanced</button>
    </div>
  </div>

  <div class="filter-count"><span id="article-count">{{ len .Pages }}</span> articles</div>
  </div>

  <!-- Search Box -->
  <div class="search-box">
    <input type="text" id="article-search" placeholder="Search articles..." class="search-input" />
    <span class="search-icon">ğŸ”</span>
  </div>

  <section class="articles-grid" id="articles-grid">
    {{ range .Pages.ByDate.Reverse }}
    <a href="{{ .Permalink }}" class="article-card" data-category="{{ .Params.category | default "uncategorized" }}" data-difficulty="{{ .Params.difficulty | default "intermediate" }}" data-title="{{ .Title | lower }}" data-tags="{{ delimit .Params.tags " " | lower }}">
      <div class="article-icon">
        {{/* Use frontmatter icon if available, otherwise match by title */}}
        {{ if .Params.icon }}
          {{ .Params.icon }}
        {{ else if in .Title "Market Structure" }}ğŸ“Š
        {{ else if in .Title "Liquidity Grab" }}ğŸ’§
        {{ else if in .Title "Fair Value" }}ğŸ“
        {{ else if in .Title "Order Block" }}ğŸ›ï¸
        {{ else if in .Title "Swing Failure" }}ğŸ”„
        {{ else if in .Title "RSI" }}ğŸ“ˆ
        {{ else if in .Title "MACD" }}ğŸ“‰
        {{ else if in .Title "Bollinger" }}ğŸ“
        {{ else if in .Title "EMA" }}ã€°ï¸
        {{ else if in .Title "SMA" }}ã€°ï¸
        {{ else if in .Title "Candlestick" }}ğŸ•¯ï¸
        {{ else if in .Title "Support" }}ğŸ›¡ï¸
        {{ else if in .Title "Resistance" }}ğŸ›¡ï¸
        {{ else if in .Title "Fibonacci" }}ğŸ”¢
        {{ else if in .Title "Volume" }}ğŸ“Š
        {{ else if in .Title "Risk" }}âš ï¸
        {{ else if in .Title "Psychology" }}ğŸ§ 
        {{ else if in .Title "Fear" }}ğŸ˜±
        {{ else if in .Title "Greed" }}ğŸ˜±
        {{ else if in .Title "Funding" }}ğŸ’°
        {{ else }}ğŸ“š
        {{ end }}
      </div>
      <h2>{{ .Title }}</h2>
      <p class="article-desc">{{ .Description }}</p>
      <div class="article-meta">
        <span class="read-time">{{ .ReadingTime }} min read</span>
        {{ if .Params.difficulty }}
        <span class="difficulty-badge difficulty-{{ .Params.difficulty }}">{{ .Params.difficulty | title }}</span>
        {{ end }}
      </div>
    </a>
    {{ end }}
  </section>

  <section class="learn-cta">
    <h2>Ready to Apply Your Knowledge?</h2>
    <p>See these concepts in action with our data-driven signals</p>
    <div class="cta-buttons">
      <a href="/posts/" class="btn-primary">View Signals</a>
      <a href="/analyze/" class="btn-secondary">Chart Analysis</a>
    </div>
  </section>
</div>

<script>
(function() {
  'use strict';

  var categoryButtons = document.querySelectorAll('.filter-btn');
  var difficultyButtons = document.querySelectorAll('.diff-btn');
  var searchInput = document.getElementById('article-search');
  var articleCards = document.querySelectorAll('.article-card');
  var articleCount = document.getElementById('article-count');
  var currentCategory = 'all';
  var currentDifficulty = 'all';
  var currentSearch = '';

  // Filter by category
  categoryButtons.forEach(function(btn) {
    btn.addEventListener('click', function() {
      categoryButtons.forEach(function(b) { b.classList.remove('active'); });
      this.classList.add('active');
      currentCategory = this.dataset.category;
      filterArticles();
    });
  });

  // Filter by difficulty
  difficultyButtons.forEach(function(btn) {
    btn.addEventListener('click', function() {
      difficultyButtons.forEach(function(b) { b.classList.remove('active'); });
      this.classList.add('active');
      currentDifficulty = this.dataset.difficulty;
      filterArticles();
    });
  });

  // Search filter
  searchInput.addEventListener('input', function() {
    currentSearch = this.value.toLowerCase().trim();
    filterArticles();
  });

  function filterArticles() {
    var visibleCount = 0;

    articleCards.forEach(function(card) {
      var category = card.dataset.category;
      var difficulty = card.dataset.difficulty;
      var title = card.dataset.title;
      var tags = card.dataset.tags;

      // Category match (treat 'risk' and 'risk-management' as same)
      var categoryMatch = currentCategory === 'all' ||
        category === currentCategory ||
        (currentCategory === 'risk-management' && category === 'risk') ||
        (currentCategory === 'risk' && category === 'risk-management');

      // Difficulty match
      var difficultyMatch = currentDifficulty === 'all' || difficulty === currentDifficulty;

      // Search match
      var searchMatch = currentSearch === '' ||
        title.indexOf(currentSearch) !== -1 ||
        tags.indexOf(currentSearch) !== -1;

      if (categoryMatch && difficultyMatch && searchMatch) {
        card.style.display = '';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });

    articleCount.textContent = visibleCount;
  }
})();
</script>
{{ end }}
